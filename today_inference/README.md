# 今日股票预测系统

基于训练好的LSTM模型，对任意股票进行当天的涨跌预测。

## 功能说明

本系统可以基于任意一次训练的日志目录，完成一次当天的股票涨跌预测。

## 使用方法

### 基本用法

```bash
python make_today_prediction.py <训练日志目录>
```

### 示例

```bash
# 使用相对路径
python make_today_prediction.py logs/20251225_175236_train_518880_20251225

# 使用绝对路径
python make_today_prediction.py /home/wxl/wxlcode/stock/AKPRE_LSTM/logs/20251225_175236_train_518880_20251225
```

## 工作流程

1. **加载训练信息**: 从训练日志目录读取 `train_info.json`，获取：
   - 股票代码
   - 模型路径
   - 训练配置信息

2. **获取最新数据**: 使用akshare获取股票的最新历史数据

3. **数据预处理**: 使用与训练时相同的预处理方法处理数据

4. **生成预测序列**: 创建最后60天（或配置的序列长度）的数据序列

5. **模型推理**: 使用训练好的模型进行预测

6. **输出结果**: 显示预测结果和概率

## 输出示例

```
============================================================
今天股票涨跌预测决策系统
============================================================

[步骤1] 加载训练信息
训练日志目录: logs/20251225_175236_train_518880_20251225
股票代码: 518880
模型路径: logs/20251225_175236_train_518880_20251225/best_model.pth
训练准确率: 63.73%

[步骤2] 获取系统日期
当前系统日期: 20251225

[步骤3] 获取股票 518880 的全部历史数据
正在获取股票数据: 518880...
成功获取ETF数据: 518880
成功获取 1234 条历史数据
数据日期范围: 2020-01-01 到 2025-12-25

[步骤4] 处理数据并生成今天的预测序列（序列长度: 60）
正在处理数据...
正在创建今天的序列...
成功创建序列，序列长度: 60
预测目标日期: 2025-12-25（今天）

[步骤5] 使用LSTM模型进行推理预测
Using device: cuda
Loading model...
Model loaded: 3xLSTM(128) + Dense(32) + Dense(2)
Preprocessing sequence data...
Input sequence shape: (1, 60, 2)
Running inference...
预测结果: 涨
涨的概率: 0.6234 (62.34%)
跌的概率: 0.3766 (37.66%)

============================================================
预测结果汇总
============================================================
股票代码: 518880
预测日期: 2025-12-25
预测结果: 涨 (1)
涨的概率: 0.6234 (62.34%)
跌的概率: 0.3766 (37.66%)
模型来源: logs/20251225_175236_train_518880_20251225
============================================================

预测完成！
```

## 目录结构

```
today_inference/
├── code/
│   ├── __init__.py
│   ├── get_stock_data.py          # 获取股票数据
│   ├── process_and_create_sequence.py  # 处理数据并生成序列
│   └── predict_today.py           # 模型推理
├── make_today_prediction.py       # 主脚本
└── README.md                      # 本文件
```

## 注意事项

1. **数据获取**: 需要网络连接，使用akshare获取最新数据
2. **模型兼容性**: 只能使用本系统训练的模型（包含scaler信息）
3. **序列长度**: 默认使用60天序列，与训练时保持一致
4. **日期处理**: 系统会自动获取最新数据，预测当天的涨跌

## 依赖

- torch
- pandas
- numpy
- akshare
- scikit-learn

## 错误处理

如果遇到错误，请检查：
1. 训练日志目录是否存在
2. 模型文件是否存在
3. 网络连接是否正常（用于获取数据）
4. 股票代码是否正确

